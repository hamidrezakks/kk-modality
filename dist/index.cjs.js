"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=e(require("react")),n=require("@material-ui/core"),i=require("lodash"),s=require("@material-ui/core/styles"),o=e(require("styled-components"));class r{constructor(){this.uniqueId=0,this.listeners={},this.newConfirmHandler=null,this.defaultOptions={cancelText:"Cancel",confirmText:"Confirm"}}static getInstance(){return this.instance||(this.instance=new r),this.instance}open(e,t){const n=i.merge(i.clone(this.defaultOptions),i.clone(e));this.uniqueId++;const s=this.uniqueId;n.id=s;let o=null,r=null;const a=new Promise(((e,t)=>{o=e,r=t}));return n.resolve=o,n.reject=r,n.cb=t,this.listeners[s]={dialog:n,id:s,reject:r,resolve:o,cb:t},this.newConfirmHandler&&this.newConfirmHandler(n),a}setNewConfirmListener(e){this.newConfirmHandler=e}removeListener(e){delete this.listeners[e]}}const a=o.div`
    position: relative;  
    height: 16px;
    
    &:after {
        content: '';
        height: 4px;
        width 36px;
        background-color: #ccc;
        border-radius: 4px;
        position: absolute;
        top: 60%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
`;class l extends t.Component{constructor(e){super(e),this.newConfirmDialogHandler=e=>{const{modalList:t,queueSize:n}=this.state;e.open=!1,t.length>n&&this.actionHandler(t[0].id,"cancel")(),e.force?t.push(e):t.unshift(e);const s=e.id;this.setState({modalList:t},(()=>{const e=this.state.modalList,t=i.findIndex(e,{id:s});t>-1&&(e[t].open=!0,this.setState({modalList:e}))}))},this.actionHandler=(e,t)=>()=>{const{modalList:n}=this.state;if(0===n.length)return;const s=i.findIndex(n,{id:e});if(-1===s)return;const o=n[s];try{o.resolve(t)}catch(e){o.reject(e)}if(o.cb)try{o.cb(t)}catch(e){console.warn(e)}let r=!1;if("cancel"===t)r=!1;else if("confirm"===t&&o.confirmPreventClose)r=!0;else if(o.buttons){const e=i.find(o.buttons,{action:t});e&&e.preventClose&&e.action===t&&(r=!0)}n[s].open=r,this.setState({modalList:n},(()=>{r||(this.confirmService.removeListener(o.id),setTimeout((()=>{const t=this.state.modalList;-1!==i.findIndex(t,{id:e})&&(t.splice(s,1),this.setState({modalList:t}))}),(this.props.dialogTransitionDuration||200)+1))}))},this.drawerOpenHandler=()=>{},this.state={modalList:[],queueSize:e.queueSize||5},this.confirmService=r.getInstance()}static getDerivedStateFromProps(e,t){return{queueSize:e.queueSize||5}}componentDidMount(){this.confirmService.setNewConfirmListener(this.newConfirmDialogHandler)}render(){const{fullScreen:e,hideDrawerAnchor:i}=this.props,{modalList:s}=this.state;return e?s.map((e=>t.createElement(n.SwipeableDrawer,{key:e.id,anchor:"bottom",open:e.open||!1,onClose:this.actionHandler(e.id,"cancel"),onOpen:this.drawerOpenHandler,transitionDuration:this.props.dialogTransitionDuration||200,className:"kk-modality-bottom-drawer",classes:Object.assign({paper:this.props.classes.drawerPaper},this.props.drawerClasses)},Boolean(!0!==i)&&t.createElement(a,{className:"kk-modality-drawer-anchor"}),this.getContact(e)))):s.map((e=>t.createElement(n.Dialog,Object.assign({key:e.id,transitionDuration:this.props.dialogTransitionDuration||200,open:e.open||!1,onClose:this.actionHandler(e.id,"cancel"),classes:this.props.dialogClasses},e.dialogProps),this.getContact(e))))}getContact(e){return t.createElement(t.Fragment,null,e.title&&t.createElement(n.DialogTitle,null,e.title),e.description&&t.createElement(n.DialogContent,null,t.createElement(n.DialogContentText,null,e.description)),t.createElement(n.DialogActions,null,Boolean(e.cancelText)&&t.createElement(n.Button,Object.assign({color:"secondary"},e.cancelProps,{onClick:this.actionHandler(e.id,"cancel")}),e.cancelText),Boolean(e.confirmText)&&t.createElement(n.Button,Object.assign({color:"primary"},e.confirmProps,{onClick:this.actionHandler(e.id,"confirm")}),e.confirmText),this.getButtonsContent(e)))}getButtonsContent(e){return e.buttons&&0!==e.buttons.length?e.buttons.map(((i,s)=>t.createElement(n.Button,Object.assign({key:s},i.props,{onClick:this.actionHandler(e.id,i.action)}),i.text))):null}}var c=n.withMobileDialog({breakpoint:"xs"})(s.withStyles({drawerPaper:{borderRadius:"12px 12px 0 0"}})(l));exports.Modality=c,exports.ModalityService=r;
