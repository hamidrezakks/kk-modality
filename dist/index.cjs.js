"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@material-ui/core"),n=require("lodash"),i=require("@material-ui/core/styles"),s=require("styled-components");function o(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var r=o(e),a=o(s);class l{constructor(){this.uniqueId=0,this.listeners={},this.newConfirmHandler=null,this.defaultOptions={cancelText:"Cancel",confirmText:"Confirm"}}static getInstance(){return this.instance||(this.instance=new l),this.instance}open(e,t){const i=n.clone(n.merge(n.clone(this.defaultOptions),n.clone(e)));this.uniqueId++;const s=this.uniqueId;i.id=s;let o=null,r=null;const a=new Promise(((e,t)=>{o=e,r=t}));return i.resolve=o,i.reject=r,i.cb=t,this.listeners[s]={dialog:i,id:s,reject:r,resolve:o,cb:t},this.newConfirmHandler&&this.newConfirmHandler(i),a}setNewConfirmListener(e){this.newConfirmHandler=e}removeListener(e){delete this.listeners[e]}}const c=a.default.div`
    position: relative;  
    height: 16px;
    
    &:after {
        content: '';
        height: 4px;
        width 36px;
        background-color: #ccc;
        border-radius: 4px;
        position: absolute;
        top: 60%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
`;class d extends r.default.Component{constructor(e){super(e),this.newConfirmDialogHandler=e=>{const{modalList:t,queueSize:i}=this.state;e.open=!1,t.length>i&&this.actionHandler(t[0].id,"cancel")(),e.force?t.push(e):t.unshift(e);const s=e.id;this.setState({modalList:t},(()=>{const e=this.state.modalList,t=n.findIndex(e,{id:s});t>-1&&(e[t].open=!0,this.setState({modalList:e}))}))},this.actionHandler=(e,t)=>()=>{const{modalList:i}=this.state;if(0===i.length)return;const s=n.findIndex(i,{id:e});if(-1===s)return;const o=i[s];try{o.resolve(t)}catch(e){o.reject(e)}if(o.cb)try{o.cb(t)}catch(e){console.warn(e)}let r=!1;if("cancel"===t)r=!1;else if("confirm"===t&&o.confirmPreventClose)r=!0;else if(o.buttons){const e=n.find(o.buttons,{action:t});e&&e.preventClose&&e.action===t&&(r=!0)}i[s].open=r,this.setState({modalList:i},(()=>{r||(this.confirmService.removeListener(o.id),setTimeout((()=>{const t=this.state.modalList;-1!==n.findIndex(t,{id:e})&&(t.splice(s,1),this.setState({modalList:t}))}),(this.props.dialogTransitionDuration||200)+1))}))},this.drawerOpenHandler=()=>{},this.state={modalList:[],queueSize:e.queueSize||5},this.confirmService=l.getInstance()}static getDerivedStateFromProps(e,t){return{queueSize:e.queueSize||5}}componentDidMount(){this.confirmService.setNewConfirmListener(this.newConfirmDialogHandler)}render(){const{fullScreen:e,hideDrawerAnchor:n}=this.props,{modalList:i}=this.state;return e?i.map((e=>r.default.createElement(t.SwipeableDrawer,{key:e.id,anchor:"bottom",open:e.open||!1,onClose:this.actionHandler(e.id,"cancel"),onOpen:this.drawerOpenHandler,transitionDuration:this.props.dialogTransitionDuration||200,className:"kk-modality-bottom-drawer",classes:Object.assign({paper:this.props.classes.drawerPaper},this.props.drawerClasses)},Boolean(!0!==n)&&r.default.createElement(c,{className:"kk-modality-drawer-anchor"}),this.getContact(e)))):i.map((e=>r.default.createElement(t.Dialog,Object.assign({key:e.id,transitionDuration:this.props.dialogTransitionDuration||200,open:e.open||!1,onClose:this.actionHandler(e.id,"cancel"),classes:this.props.dialogClasses},e.dialogProps),this.getContact(e))))}getContact(e){return r.default.createElement(r.default.Fragment,null,e.title&&r.default.createElement(t.DialogTitle,null,e.title),e.description&&r.default.createElement(t.DialogContent,null,r.default.createElement(t.DialogContentText,null,e.description)),r.default.createElement(t.DialogActions,null,Boolean(e.cancelText)&&r.default.createElement(t.Button,Object.assign({color:"secondary"},e.cancelProps,{onClick:this.actionHandler(e.id,"cancel")}),e.cancelText),Boolean(e.confirmText)&&r.default.createElement(t.Button,Object.assign({color:"primary"},e.confirmProps,{onClick:this.actionHandler(e.id,"confirm")}),e.confirmText),this.getButtonsContent(e)))}getButtonsContent(e){return e.buttons&&0!==e.buttons.length?e.buttons.map(((n,i)=>r.default.createElement(t.Button,Object.assign({key:i},n.props,{onClick:this.actionHandler(e.id,n.action)}),n.text))):null}}var u=t.withMobileDialog({breakpoint:"xs"})(i.withStyles({drawerPaper:{borderRadius:"12px 12px 0 0"}})(d));exports.Modality=u,exports.ModalityService=l;
